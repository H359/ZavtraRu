{% extends base_template %}

{% block meta_author %}{% if item.authors_all %}{% for author in item.authors_all %}{{ author.get_full_name }}{% if not forloop.last %},{% endif %}{% endfor %}{% else %}{{ block.super }}{% endif %}{% endblock %}
{% block meta_extra %}{{ block.super }}{% spaceless %}
<meta property="og:title" content="{{ item.title }}" />
<meta property="og:locale" content="ru_RU" />
<meta property="og:url" content="http://zavtra.ru{{ item.get_absolute_url }}" />
{% if item.kind == 'video' %}
<meta property="og:type" content="video.other" />
<meta property="og:image" content="http://img.youtube.com/vi/{{ item.get_video_id }}/0.jpg" />
<meta property="og:video" content="{% spaceless %}{{ item.content }}{% endspaceless %}" />
{% else %}
<meta property="og:type" content="article" />
{% if item.authors_all %}{% for author in item.authors_all %}
<meta property="og:article:author" content="{{ author.get_full_name }}" />
{% endfor %}{% endif %}
{% endif %}
{% endspaceless %}
{% endblock %}

{% load pytils_dt %}
{% load comments %}

{% block page_title %}{{ block.super }} / {% if item.rubric %}{{ item.rubric.title|safe }}{% else %}Блоги{% endif %} / {{ item.title|safe }}{% endblock %}
{% block javascript_library %}{{ block.super }}<script type="text/javascript" src="//yandex.st/share/share.js" charset="utf-8"></script>{% endblock %}

{% block content %}
<section class="container container_16 clearfix">
    <h1 class="article">{% if item.rubric %}<a href="{{ item.rubric.get_absolute_url }}">{{ item.rubric.title|safe }}</a>{% else %}Блоги{% endif %}</h1>
    <article class="grid_8 alpha block of-kind-{{ item.kind }}">
        <header>
            <h1>
                <time pubdate="pubdate" datetime="{{ item.pub_date }}">{{ item.pub_date|ru_strftime }}</time>
                {{ item.title|safe }}
            </h1>
            {% if item.subtitle %}<h2>{{ item.subtitle|safe }}</h2>{% endif %}
        </header>
	    <div class="content">
            {% for author in item.authors_all %}<a href="{{ author.get_absolute_url }}">{{ author.get_full_name }}</a>{% if not forloop.last %}, {% endif %}{% endfor %}
	    </div>
            {% if item.kind == 'video' %}
            <div class="text-center">
                <object width="425" height="344">
                <param name="movie" value="http://youtube.com/v/{{ item.get_video_id }}&version=3"</param>
                <param name="allowFullScreen" value="true"></param>
                <param name="allowScriptAccess" value="always"></param>
                <param name="wmode" value="transparent"></param>
                <embed src="http://youtube.com/v/{{ item.get_video_id }}&version=3"
                  type="application/x-shockwave-flash"
                  allowfullscreen="true"
                  allowscriptaccess="always"
                  wmode="transparent"
                  width="425" height="344">
                </embed>
                </object>
            </div>
            {% endif %}
            <div class="content">
                {% if item.kind == 'image' %}
                    <div class="text-center"><img src="{{ MEDIA_URL }}{{ item.thumbnail }}" /></div>
                {% endif %}
                {% if item.kind == 'text' or item.kind == '' %}
                    {% if item.content|length > 1500 %}<div class="yashare-auto-init" data-yashareL10n="ru" data-yashareType="link" data-yashareQuickServices="yaru,vkontakte,facebook,twitter,odnoklassniki,moimir,lj,blogger,digg,greader,juick,liveinternet"></div>{% endif %}
                    {{ item.content|safe }}
                {% endif %}
                <div class="yashare-auto-init" data-yashareL10n="ru" data-yashareType="link" data-yashareQuickServices="yaru,vkontakte,facebook,twitter,odnoklassniki,moimir,lj,blogger,digg,greader,juick,liveinternet"></div>
            </div>

            <footer>
                {% with tags=item.tags.all %}
                {% if tags|length %}
                {% block meta_keywords %}{{ block.super }},{% for tag in tags %}{{ tag }}{% if not forloop.last %},{% endif %}{% endfor %}{% endblock %}
                <div class="separator"></div>
                <div class="content">
                Теги:
                    {% for tag in tags %}
                    <a rel="tag" href="{{ tag.get_absolute_url }}">{{ tag }}</a>{% if not forloop.last %},&nbsp;{% endif %}
                    {% endfor %}
                </div>
                {% endif %}
                {% endwith %}
                {% comment %}<div class="buttons">
                {% if request.user.is_authenticated %}
            	    {% load voting_tags %}
            	    {% vote_by_user request.user on item as vote %}
            	    <form method="post" action="{% url vote %}"><input type="hidden" name="djoi" value="{{ item.id }}" /><input type="hidden" name="djct" value="{{ item.get_content_type_id }}" />{% csrf_token %}<input type="hidden" name="vote" value="up"><button {% if vote.is_upvote %}disabled="disabled"{% endif %} type="submit" class="{% if vote.is_upvote %}on disabled active{% endif %} button"><span class="icon icon101"></span></button></form>
            	    <form method="post" action="{% url vote %}"><input type="hidden" name="djoi" value="{{ item.id }}" /><input type="hidden" name="djct" value="{{ item.get_content_type_id }}" />{% csrf_token %}<input type="hidden" name="vote" value="down"><button {% if vote.is_downvote %}disabled="disabled"{% endif %} type="submit" class="{% if vote.is_downvote %}on disabled active{% endif %} button"><span class="icon icon100"></span></button></form>
                {% endif %}
            	    {{ item.rating }}
                </div>{% endcomment %}
                <div id="comments_block">{% get_comments_for item %}</div>
            </footer>
    </article>
    <article class="grid_4">
	{% include 'partials/centerside.html' %}
    </article>
    <article class="grid_4 omega">
	{% include 'partials/rightside.html' %}
    </article>
</section>
{% endblock %}

{% block js_extra_head %}
{{ block.super }}
{% endblock %}