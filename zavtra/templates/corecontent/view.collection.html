<%inherit file="../base.html" />
<%block name="page_title">${ parent.page_title() } / ${ title }</%block>

<%def name="rubric_contents(items, is_paginated)">
<ul class="unstyled articles">
    % for item in items:
    <% url = item.get_absolute_url() %>\
    <li class="bordered">
	<h4><a href="${ url }">${ item.title }</a></h4>
	% if item.subtitle:
	<h5><a href="${ url }">${ item.subtitle }</a></h5>
	% endif
	% if item.authors_all:
	    % for num, author in enumerate(item.authors_all):
	    % if num != 0:
	    , \
	    % endif
	    <a class="author" href="${ author.get_absolute_url() }">${ author.get_full_name() }</a>
	    % endfor
	% endif
	<div data-clickable="${ url }" class="article-text">
	    % if item.kind == 'video':
	    <div class="text-center">
		<img src="http://img.youtube.com/vi/${ item.get_video_id() }/0.jpg" />
	    </div>
	    % endif
	    ${ item.description }
	</div>
	<a href="${ url }#comments"><i class="icon-comment"></i> ${ self.comments_count(item.comments_count) }</a>
    </li>
    % endfor
</ul>
% if is_paginated:
<div class="pagination pagination-right">
    <ul>
	<li class="prev<% if not page_obj.has_previous(): context.write(' disabled') %>"><a rel="page" href="?page=${ page_obj.previous_page_number() }">&larr; Позже</a></li>
	% for p in page_obj.page_range:
	<li<% if page_obj.number == p: context.write(' class="active"') %>">
	% if p:
	<a rel="page" href="?page=${ p }">${ p }</a>
	% else:
	<a>...</a>
	% endif:
	</li>
	% endfor
	<li class="next<% if not page_obj.has_next(): context.write(' disabled') %>"><a rel="page" href="?page=${ page_obj.next_page_number() }">Раньше &rarr;</a></li>
    </ul>
</div>
% endif
</%def>

<%def name="sidebar(parent, items, level=0)">
% if level == 0 and parent.description and len(parent.description) > 0:
<div class="alert alert-block">${ parent.description }</div>
% endif
% if len(items):
% if level == 0:
<div class="well"><ul class="nav nav-tabs nav-stacked">
% endif
% for item in items:
<li style="margin-left: ${ level*8 }px;">
    <a href="${ item.get_absolute_url() }"><strong>${ item.title }</strong></a>
    ${ sidebar(item, item.get_children(rubrics=rubrics), level=level+1) }
</li>
% endfor
% if level == 0:
</ul></div>
% endif
% endif
</%def>

<%block name="side_column">
${ self.news_block(news) }
${ parent.side_column() }
<h3>Реклама</h3><div class="bnrok" id="DIV_DA_49095"></div><% banners_pool.append(49095) %>\
<div id="oomph3" class="bnrok yandex-direct"></div>\
</div>
</%block>

<%block name="main_column">
<%
parents = []
if rubric and rubric.parent_id is not None: 
    ss = rubric
    while True:
	try:
	    ss = filter(lambda w: w.id == ss.parent_id, rubrics)[0]
	except IndexError:
	    break
	parents.append(ss)
    parents.reverse()
%>\
<ul class="breadcrumb">
    <li><a href="/">Главная</a><span class="divider">/</span></li>
    % if len(parents):
    % for parent in parents:
    <li><a href="${ parent.get_absolute_url() }">${ parent.title }</a><span class="divider">/</span></li>
    % endfor
    % endif
    <li>${ title }</li>
    % if rss:
    <li class="rss">&nbsp;<a href="${ rss }">RSS</a></li>
    % endif
</ul>
<div>
% if rubric_id == 55:
<p><img src="${ STATIC_URL }img/ns.jpg" class="pull-left" /><h4>Стратегия: новый социализм</h4><h5>Информационно-дискуссионная площадка</h5></p>
% endif
<%
children = []
if rubric and 0 < rubric.children_render:
    children = rubric.get_children(rubrics=rubrics)
%>
<div class="bnrok" id="DIV_DA_49096"></div><% banners_pool.append(49096) %>\
% if len(children) == 0:
${ rubric_contents(items, is_paginated) }
% else:
    <div class="row-fluid">
    % if rubric.children_render == 1:
    <div class="span4">${ sidebar(rubric, children) }</div>
    <div class="span8">${ rubric_contents(items, is_paginated) }</div>
    % else:
    not ready
    % endif
    </div>
% endif
<div class="bnrok" id="DIV_DA_55241"></div><% banners_pool.append(55241) %>\
</div>
</%block>