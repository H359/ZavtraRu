<%!
from pytils import numeral, dt
from zavtra.comments.template_tags import get_comments_for
%>\
<%def name="news_block(items)">\
<h3>Новости <a href="/content/rubric/novosti/">&raquo;</a></h3>\
<dl class="unstyled news">\
% for item in items:
<% url = item.get_absolute_url() %>\
    <dt><a href="${ url }">${ item.title }</a></dt>\
    <dd>
	<time datetime="datetime" pubdate="${ item.pub_date }">${ self.ru_date(item.pub_date) }</time>\
	<div data-clickable="${ url }" class="article-text">${ item.description }</div>\
    </dd>
% endfor
</dl>
</%def>\
<%def name="comment(item)">\
<% author = item.get_author() %>\
<li id="comment-${ item.id }" style="padding-left: ${ item.depth_truncated()*40 }px">\
    <div class="comment">\
	<div class="avatar">\
	    <a href="#" rel="popover" data-content="Пользователь ${ author } с нами с ${ ru_date(item.author.date_joined,inflected=True,format=u'%d %B %Y') }" title="${ author }"><img src="${ item.author.avatar() }" width="32" /></a>\
	</div>\
	<div class="inner">\
	    <div class="body clearfixer">\
		<div class="author"><a href="${ item.author.get_absolute_url() }">${ item.author }</a>, <time datetime="${ item.created_at }">${ ru_date(item.created_at) }<time></div>\
		<div class="text">\
		% if item.enabled:
		<pre>${ item.comment | h }</pre>\
		% else:
		<em>комментарий скрыт</em>\
		    % if request.user.is_authenticated() and request.user.is_staff:
		    <br/>Текст:<br/><pre>${ item.comment | h }</pre>\
		    % endif
		% endif
		</div>\
		<div class="btn-group pull-right">\
		    % if request.user.is_authenticated() and request.user.is_active:
			% if item.enabled:
			<a href="#reply:${ item.id }" class="btn btn-success">Ответить</a>\
			% endif
			% if request.user.is_staff:
			<%doc>and perms.comments.moderate</%doc>\
			    % if item.enabled:
			    <a href="#hide:${ item.id }}" class="btn btn-danger">Скрыть</a>\
			    % else:
			    <a href="#hide:${ item.id }}" class="btn btn-danger">Раскрыть</a>\
			    % endif 
			% endif
		    % endif
		</div>\
	    </div>\
	</div>\
    </div>\
</li>\
</%def>\
<%def name="comments_for(item)">\
<% comments = get_comments_for(item) %>\
<div class="comments inside-article-text">\
    <h3>Комментарии</h3>\
    <div class="content"><ul id="comments" class="unstyled">\
	% for comment_item in comments['comments']:
	${ comment(comment_item) }
	% endfor
    </ul></div>\
    % if request.user.is_authenticated():
    <div class="comment-form comment clearfixer">\
	<div class="alert-message error hide">Похоже, вы что-то неправильно заполнили. Ниже вы найдёте дополнительную информацию.</div>\
	<div class="avatar"><img src="${ request.user.avatar() }" width="32" /></div>\
	<form class="inner" method="post" action="/comments/add/">\
	    <fieldset class="body">\
		<h4>Ваш комментарий:</h4>\
		<div>
		    <input type="hidden" name="csrfmiddlewaretoken" value="${ csrf_token }" />
		    <input type="hidden" name="next" value="${ request.path }" />
		</div>\
		% for field in comments['form']:
		% if field.is_hidden:
		<div>${ field }</div>\
		% else:
		<div class="clearfix">\
		    ${ field.label_tag() }
		    <div class="input">\
			${ field }
			% if field.help_text:
			<span class="help-block">${ field.help_text }</span>\
			% endif
		    </div>\
		</div>\
		% endif
		% endfor
		<div class="actions"><input type="submit" class="btn primary"  value="Отправить" /></div>\
	    </fieldset>\
	</form>\
    </div>\
    <script>window.comments_bootstrap=function(){$('#comments').comments();}</script>\
    % else:
    <div class="alert alert-info">\
	<p>Чтобы иметь возможность оставлять комментарии, вам нужно <a href="/login/">войти в свою учетную запись</a> (на сайте существует возможность зайти под учетной записи Twitter, Facebook и Живого Журнала) или <a href="/accounts/register/">зарегистрировать её</a>, если у вас таковой еще нет.</p>\
    </div>
    % endif
</div>\
</%def>\
<%def name="ru_date(date, inflected=False, format=u'%d.%m.%Y')">${ dt.ru_strftime(date=date, inflected=inflected, format=format) }</%def>\
<%def name="comments_count(num)">${ numeral.get_plural(num, (u'комментарий', u'комментария', u'комментариев'), u'нет комментариев') }</%def>\
<!DOCTYPE html>
<html lang="ru">\
    <head>\
	<meta charset="utf-8" />\
	<title><%block name="page_title">Газета &laquo;Завтра&raquo;</%block></title>\
	<meta name="keywords" content="<%block name="meta_keywords">Россия,русский народ,проханов,свежий номер</%block>" />\
	<meta name="description" content="<%block name="meta_description">Сетевое представительство газеты Завтра</%block>" />\
	<meta name="author" content="<%block name="meta_author">Редакция газеты Завтра</%block>" />\
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />\
	<meta name="yandex-verification" content="79bffe9a083206fe" />\
	<%block name="meta_extra"></%block>\
	<link rel="stylesheet" type="text/css" href="${ STATIC_URL }css/3.0/style.css" />\
	<link rel="alternate" type="application/rss+xml" title="Газета Завтра" href="http://zavtra.ru[% url corecontent.rss.latest %]" />\
	<link rel="shortcut icon" href="${ STATIC_URL }img/zav_icon.gif" />\
	<link rel="stylesheet" type="text/css" href="${ STATIC_URL }css/2.0/iehacks.css" />\
	<script>var _gaq = _gaq || [];_gaq.push(['_setAccount', 'UA-27628875-1']);_gaq.push(['_trackPageview']);(function() {var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);})();</script>\
    </head>\
    <body>\
	<!-- tns-counter.ru -->\
	<script type="text/javascript">var img = new Image();img.src = 'http://www.tns-counter.ru/V13a***R>' + document.referrer.replace(/\*/g,'%2a') + '*zavtra_ru/ru/UTF-8/tmsec=zavtra_total/' + Math.round(Math.random() * 1000000000);</script>\
	<noscript><img src="http://www.tns-counter.ru/V13a****zavtra_ru/ru/UTF-8/tmsec=zavtra_total/" width="1" height="1" alt=""></noscript>\
	<!--/ tns-counter.ru -->\
	<div class="navbar navbar-fixed-top">
	    <div class="navbar-inner">
	        <div class="container-fluid">
		    <ul class="nav">
		        <li><a href="/#gazette">Газета</a></li>
		        <li><a href="/content/rubric/voprosyi-prohanovu/">Вопросы Проханову</a></li>
		    </ul>
		    <form action="/search/" method="get" class="navbar-search">
		        <input class="search-query" type="search" name="query" placeholder="Поиск..." />
		    </form>
		    <ul class="nav pull-right">
		        % if request.user.is_authenticated():
		        <li><a>Здравствуйте, ${ request.user.get_full_name() }!</a></li>
		        <li><a href="/logout/">Выйти</a></li>
		        % else:
		        <li><a href="/login/">Войти</a></li>
		        % endif
		    </ul>
		</div>
	    </div>
	</div>
	<div class="container-fluid">
	    <div class="row-fluid">
		<div id="logo"><a href="/"><img src="${ STATIC_URL }img/logo.gif" /></a></div>
		% if quote is not None:
		<blockquote id="main-cite">&laquo;<a href="${ quote.source.get_absolute_url() }">${ quote.quote }</a>&raquo;</blockquote>
		% endif
	    </div>
	    <div class="row-fluid">
		<div class="span10">
		    <div class="rubrics-list">
			<ul class="nav nav-pills">
			    % for item in filter(lambda w: w.on_top, rubrics):
			    <li><a href="${ item.get_absolute_url() }">${ item.title }</a></li>
			    % endfor
			</ul>
		    </div>
		    <div class="featured-list">
			<ul class="nav nav-pills">
			    % for item in featured:
			    <li><a href="${ item.get_absolute_url() }">${ item.title }</a></li>
			    % endfor
			</ul>
		    </div>
		    <div class="red-stripe">
			<h3>Красная строка</h3>
			<div class="scrollee">
			    <ul class="unstyled scrollable ym-clearfix">
				% for num,item in enumerate(current_items):
				<li${ " class='first'" if num == 0 else "" }>
				    <% url = item.get_absolute_url() %>
				    <h4><a href="${ url }">${ item.title }</a></h4>
				    <div class="article-text" data-clickable="${ url }">${ item.description }</div>
				</li>
				% endfor
			    </ul>
			    <div id="slider"></div>
			</div>
		    </div>
		</div>
		<div class="span2">
		    <div class="adv rubrics">
			<h3>Реклама</h3>
			<div class="bnrok" id="DIV_DA_49094"></div><% banners_pool.append(49094) %>
		    </div>
		</div>
	    </div>
	    <div class="row-fluid">
		<div class="span8"><%block name="main_column"></%block></div>
		<div class="span4 rubrics"><%block name="side_column"><%include file="minipoll/latest_poll.html" /></%block></div>
	    </div>
	    <div class="row-fluid">
		<h3>Реклама</h3>
		<div class="bnrok" id="DIV_DA_50417"></div><% banners_pool.append(50417) %>
	    </div>
	    <div class="row-fluid">
		<address>
		    <strong>Адрес редакции:</strong><br/>
		    119146, Москва, Фрунзенская наб., 18–60<br/>
		    Электронная почта: <a href="mailto:zavtra@zavtra.ru">zavtra@zavtra.ru</a><br/>
		    Телефон: (495) 726-54-83
		</address>
		<a href="http://zavtra.ru/content/rubric/tehnicheskij-blog/">Технический блог</a><br/>
		Электронная почта технического отдела <a href="mailto:web@zavtra.ru">web@zavtra.ru</a>.
	    </div>
	</div>
	<script src="${ STATIC_URL }js/jquery.1.7.min.js"></script>
	<script src="${ STATIC_URL }js/jquery.lightbox-0.5.js"></script>
	<script src="${ STATIC_URL }js/bootstrap-transition.js"></script>
	<script src="${ STATIC_URL }js/jquery.cookie.js"></script>
	<script src="${ STATIC_URL }js/jquery.ui.custom.js"></script>
	<script src="${ STATIC_URL }js/bootstrap-carousel.js"></script>
	<script src="${ STATIC_URL }js/comments.js"></script>
	<script src="${ STATIC_URL }js/core.js"></script>
	% for i in banners_pool:
	<script charset="windows-1251" type="text/javascript" src="http://www.directadvert.ru/show.cgi?adp=${ i }&div=DIV_DA_${ i }"></script>
	% endfor
    </body>
</html>