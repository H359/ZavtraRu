<%! from random import randint %>\
<%inherit file="base.html" />\
<%block name="body_class">gazette</%block>\
<%block name="page_title">${ parent.page_title() }</%block>\
<%def name="rubric_announce(group, withrow)">\
<% i, glen = 0, len(group['items']) %>\
<h3>${ group['rubric'].title }&nbsp;<a href="${ group['rubric'].get_absolute_url() }">&raquo;</a></h3>
% while True:
<%
cslice = group['items'][i:i+3]
lcslice = len(cslice)
if lcslice == 0: break 
row = 12 / lcslice
%>\
% if withrow:
<div class="row-fluid">
% endif
% for num, item in enumerate(cslice):
<% url = item.get_absolute_url() %>
% if withrow:
<div class="span${ row }">
% endif
    <h4><a href="${ url }">${ item.title }</a></h4>
    % if item.authors_all:
    <div>
	% for num, author in enumerate(item.authors_all):
	% if num != 0:
	, \
	% endif
	<a href="${ author.get_absolute_url() }">${ author.get_full_name() }</a>
	% endfor
    </div>
    % endif
    <div data-clickable="${ url }" class="article-text">${ item.description }</div>
    <a href="${ url }#comments"><i class="icon-comment"></i> ${ self.comments_count(item.comments_count) }</a>
% if withrow:
</div>
% endif
% endfor
% if withrow:
</div>
% endif
<% i += 3 %>\
% endwhile
</%def>\
<%block name="main_column">\
    <div>
	<%doc>TODO: Remove direct link to zavtra.ru</%doc>
	<img src="http://zavtra.ru/media/${ illustration.for_main }" class="bordered full-image" />
	<div class="text"><h3><a href="#">&laquo;${ illustration.title }&raquo;, Геннадий Животов</a></h3></div>
    </div>
    <h2>Выпуск №${ issue_info['num'] }&nbsp;<small>от ${ self.ru_date(issue_info['date'],inflected=True,format=u'%d %B %Y') } <a href="/media/content/pdfs/4PDF.zip" class="btn small pull-right primary">скачать PDF</a></small></h2>
    <% num, nlen = 0, len(newsletter) %>\
    <div class="container-fluid rubrics equalized">
	% while nlen > num:
	% if len(newsletter[num]['items']) == 1 and nlen > num+1 and len(newsletter[num+1]['items']) == 1:
	<div class="row-fluid">
	    <div class="span6"><div class="bordered column">${ rubric_announce(newsletter[num], False) }</div></div>
	    <div class="span6"><div class="bordered column">${ rubric_announce(newsletter[num+1], False) }</div></div>
	</div>
	<% num += 2 %>\
	% else:
	<div class="bordered">${ rubric_announce(newsletter[num], True) }</div>
	<% num += 1 %>\
	% endif
	% endwhile
    </div>
</%block>\
<%def name="video_cell(item)">\
<div class="item<% if item[0] == 0: context.write(' active') %>">
    <% url = item[1].get_absolute_url() %>\
    <img src="http://img.youtube.com/vi/${ item[1].get_video_id() }/0.jpg" class="full-image" />
    <%doc><div class="carousel-caption"><h2><a href="${ url }">${ item[1].title }<i class="icon-share-alt"></i></a></h2></div></%doc>
    <h2><a href="${ url }">${ item[1].title }<i class="icon-share-alt"></i></a></h2>
</div>
</%def>\
<%block name="side_column">\
% if zavtra_tv is not None:
<div id="zavtra_tv" class="bordered">
    <%doc>
    <div id="tv-carousel" class="carousel slide">
	<div class="carousel-inner">${ ''.join(map(video_cell, enumerate(zavtra_tv))) }</div>
	<a class="left carousel-control" href="#tv-carousel" data-slide="prev">&lsaquo;</a>
	<a class="right carousel-control" href="#tv-carousel" data-slide="next">&rsaquo;</a>
    </div>
    </%doc>
    ${ ''.join(map(video_cell, enumerate(zavtra_tv))) }
</div>
% endif
<div>
    ${parent.side_column()}
    % if special_project is not None:
    <div class="alert alert-important">
	<h3>Спецпроект <a href="/content/rubric/spetsproekt-2/">&raquo;</a></h3>
	<% url = special_project.get_absolute_url() %>
	<h4><a title="${ special_project.title }" href="${ url }">${ special_project.title }</a></h4>
	<div data-clickable="${ url }" class="article-text">${ special_project.description }</div>
	<div class="comments-count"><a href="${ url }#comments">${ self.comments_count(special_project.comments_count) }</a></div>
    </div>
    % endif
    <h3>Реклама</h3>
    <div class="bnrok" id="DIV_DA_49095"></div><% banners_pool.append(49095) %>\
    <div class="bnrok yandex-direct"></div>\
    ${ self.news_block(news) }
</div>
</%block>\