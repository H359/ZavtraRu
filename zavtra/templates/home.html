<%! from random import randint %>\
<%inherit file="base.html" />\
<%block name="body_class">gazette</%block>\
<%block name="page_title">${ parent.page_title() }</%block>\
<%def name="rubric_announce(group)">\
<h3>${ group['rubric'].title }&nbsp;<a href="${ group['rubric'].get_absolute_url() }">&raquo;</a></h3><% i, glen = 0, len(group['items']) %>\
% while True:
<%
cslice = group['items'][i:i+3]
lcslice = len(cslice)
if lcslice == 0: break 
row = 100 / lcslice
noalign = False
if row == 100:
    row = 'box'
    noalign = True
%>\
<div class="ym-grid ym-equalize">\
    % for num, item in enumerate(cslice):
    <div class="ym-clearfix<% if not noalign: context.write(' ym-g%s ym-g%s' % (row, 'r' if num==lcslice-1 else 'l')) %>">\
	<% url = item.get_absolute_url() %>\
	<h4><a href="${ url }">${ item.title }</a></h4>\
	% if item.authors_all:
	<div>
	% for num, author in enumerate(item.authors_all):
	% if num != 0:
	, \
	% endif
	<a href="${ author.get_absolute_url() }">${ author.get_full_name() }</a>\
	% endfor
	</div>
	% endif
	<div data-clickable="${ url }" class="article-text">${ item.description }</div>\
	<div class="comments-count"><a href="${ url }#comments">${ self.comments_count(item.cached_comments_count()) }</a></div>\
    </div>\
    % endfor
    <% i += 3 %>\
</div>\
% endwhile
</%def>\
<%block name="main_column">\
    <div class="text-over-image" id="gazette">
	<%doc>TODO: Remove direct link to zavtra.ru</%doc>
	<img src="http://zavtra.ru/media/${ illustration.for_main }" class="bordered notopmargin" />
	<div class="text"><h3><a href="#">&laquo;${ illustration.title }&raquo;, Геннадий Животов</a></h3></div>
    </div>
    <h2>Выпуск №${ issue_info['num'] }&nbsp;<small>от ${ self.ru_date(issue_info['date'],inflected=True,format=u'%d %B %Y') } <a href="/media/content/pdfs/4PDF.zip" class="btn small pull-right primary">скачать PDF</a></small></h2>
    <% num, nlen = 0, len(newsletter) %>\
    % while nlen > num:
    <div class="ym-grid rubrics bordered">
	% if len(newsletter[num]['items']) == 1 and nlen > num+1 and len(newsletter[num+1]['items']) == 1:
	<div class="ym-g50 ym-gl"><div class="ym-gbox">${ rubric_announce(newsletter[num]) }</div></div>
	<div class="ym-g50 ym-gr"><div class="ym-gbox">${ rubric_announce(newsletter[num+1]) }</div></div>
	<% num += 2 %>\
	% else:
	<div class="ym-gbox">${ rubric_announce(newsletter[num]) }</div>
	<% num += 1 %>\
	% endif
    </div>
    % endwhile
</%block>\
<%def name="video_cell(item,big=False)">\
<div class="bordered ${ 'notopmargin' if big else '' }"><div class="text-over-image">
    <% url = item.get_absolute_url() %>\
    <img data-clickable="${ url }" src="http://img.youtube.com/vi/${ item.get_video_id() }/${ '0' if big else unicode(randint(1,3)) }.jpg" />
    <div class="text"><h4><a href="${ url }">${ item.title }</a></h4></div>
</div></div>
</%def>\
<%block name="side_column">\
% if zavtra_tv is not None:
<div class="ym-grid">
    % for num, item in enumerate(zavtra_tv):
    % if num == 0:
    <div class="ym-gbox">${ video_cell(item,big=True) }</div>
    % else:
    <div class="ym-g50 ym-g${ 'l' if num == 1 else 'r' }"><div class="ym-gbox">${ video_cell(item) }</div></div>
    % endif
    % endfor
</div>
% endif
<div class="ym-grid linearize-level-1">
    <div class="ym-gbox">
	${parent.side_column()}
    </div>
    <div class="ym-g50 ym-gl"><div class="ym-gbox">
	% if special_project is not None:
	<h3>Спецпроект <a href="/content/rubric/spetsproekt-2/">&raquo;</a></h3>
	<div class="ym-clearfix"><% url = special_project.get_absolute_url() %>
	    <h4><a title="${ special_project.title }" href="${ url }">${ special_project.title }</a></h4>
	    <div data-clickable="${ url }" class="article-text">${ special_project.description }</div>
	    <div class="comments-count"><a href="${ url }#comments">${ self.comments_count(special_project.cached_comments_count()) }</a></div>
	</div>
	% endif
	<h3>Реклама</h3>
	<div class="bnrok" id="DIV_DA_49095"></div><% banners_pool.append(49095) %>\
    </div></div>
    <div class="ym-g50 ym-gr"><div class="ym-gbox">${ self.news_block(news) }</div></div>
</div>
</%block>\